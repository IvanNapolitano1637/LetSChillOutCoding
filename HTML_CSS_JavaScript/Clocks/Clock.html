<!doctype html>
<html lang="en"><!--C03#009 - Nicola - Clock-->
	<head>
		<meta charset="utf-8">
		<title>Clock</title>
		<style>
			*{
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			body{
				display: flex;
				justify-content: center;
				align-items: center;
				min-height: 100vh;
				overflow: hidden;
				background: #2f363e;
			}
			.clock{
				position: relative;
				width: 280px;
				height: 280px;
				display: flex;
				justify-content: center;
				align-items: center;
				scale: 2.8;
				box-shadow: inset 5px 5px 25px rgba(0,0,0,0.25);
				border-radius: 50%;
				cursor: pointer;
				-webkit-tap-highlight-color: transparent;
			}
			.clock::before{
				content: '';
				position: absolute;
				width: 5px;
				height: 5px;
				background: #2f363e;
				z-index: 10000;
				border: 1px solid #fff;
				border-radius: 50%;
			}
			#time{
				position: relative;
				width: 250px;
				height: 250px;
				display: flex;
				justify-content: center;
				align-items: center;
			}
			.circle{
				position: absolute;
				display: flex;
				justify-content: center;
				align-items: center;
			}
			.circle svg{ 
				position: relative; 
				transform: rotate(270deg); 
			} 
			.circle:nth-child(1) svg{
				width: 250px;
				height: 250px;
			}
			.circle:nth-child(2) svg{
				width: 210px;
				height: 210px;
			}
			.circle:nth-child(3) svg{
				width: 170px;
				height: 170px;
			}
			.circle svg circle{
				fill: transparent;
				stroke-width: 8;
				stroke: var(--clr);
				transform: translate(5px,5px);
				opacity: 0.25;
				transition: stroke-dashoffset 0.5s ease;
			}
			#ss{
				stroke-dasharray: 760;
				stroke-dashoffset: 760;
			}
			#mm{
				stroke-dasharray: 630;
				stroke-dashoffset: 630;
			}
			#hh{
				stroke-dasharray: 510;
				stroke-dashoffset: 510;
			}
			.dots{
				position: absolute;
				width: 100%;
				height: 100%;
				display: flex;
				align-items: flex-start;
				justify-content: center;
				z-index: 10;
			}
			.dots::before{
				content: '';
				position: absolute;
				top: -3px;
				width: 10px;
				height: 10px;
				background: var(--clr);
				border-radius: 50%;
				box-shadow: 0 0 20px var(--clr), 0 0 40px var(--clr);
			}
			.niddles{
				position: absolute;
				width: 200px;
				height: 200px;
				display: flex;
				justify-content: center;
				z-index: 10;
			}
			.niddles i{
				position: absolute;
				width: 2px;
				background: var(--clr2);
				height: 50%;
				opacity: 0.75;
				border-radius: 6px;
				transform-origin: bottom;
				transform: scaleY(0.5);
			}
			.niddles.niddle2{
				width: 170px;
				height: 170px;
			}
			.niddles.niddle3{
				width: 140px;
				height: 140px;
			}
			#time span{
				position: absolute;
				inset: 55px;
				text-align: center;
				color: #999;
				font-family: consolas;
				transform: rotate(calc(15deg*var(--i)));
				pointer-events: none;
			}
			#time span b{
				font-size: 0.25em;
				font-weight: 500;
				display: inline-block;
				transform: rotate(calc(-15deg*var(--i)));
			}			
		</style>
	</head>
	<body>
		<div class="clock" onclick="changeClockDirection()">
			<div id="time">
				<div class="circle" style="--clr:#ff0000">
					<div class="dots" id="sec_dot"></div>
					<svg id="svg_s"><circle cx="120" cy="120" r="121" id="ss"></circle></svg>
				</div>
				<div class="circle" style="--clr:#0000ff">
					<div class="dots" id="min_dot"></div>
					<svg id="svg_m"><circle cx="100" cy="100" r="100" id="mm"></circle></svg>
				</div>
				<div class="circle" style="--clr:#ffff00">
					<div class="dots" id="hr_dot"></div>
					<svg id="svg_h"><circle cx="80" cy="80" r="81" id="hh"></circle></svg>
				</div>
				<div class="niddles" style="--clr2:#ff0000;" id="sc"><i></i></div>
				<div class="niddles niddle2" style="--clr2:#0000ff;" id="mn"><i></i></div>
				<div class="niddles niddle3" style="--clr2:#ffff00;" id="hr"><i></i></div>
			</div>
		</div>

		<script>
			let reverse = true;
			let lastS = -1;
			const audioCtx = new(window.AudioContext || window.webkitAudioContext)();

			function playTick(){
				const osc = audioCtx.createOscillator();
				const gain = audioCtx.createGain();
				osc.type = 'sine';
				osc.frequency.setValueAtTime(reverse ? 150 : 800, audioCtx.currentTime);
				gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
				gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.1);
				osc.connect(gain);
				gain.connect(audioCtx.destination);
				osc.start();
				osc.stop(audioCtx.currentTime + 0.1);
			}

			function playBell(hour){
				let rintocchi = hour%12 || 12;
				for(let i = 0; i < rintocchi; i++){
					setTimeout(() => {
						const now = audioCtx.currentTime;
						[110, 220, 440.5].forEach((freq, index) => {
							const osc = audioCtx.createOscillator();
							const gain = audioCtx.createGain();
							osc.type = index === 0 ? 'sine' : 'triangle';
							osc.frequency.setValueAtTime(freq, now);
							gain.gain.setValueAtTime(0.2*(index + 1), now);
							gain.gain.exponentialRampToValueAtTime(0.00001, now + 3);
							osc.connect(gain);
							gain.connect(audioCtx.destination);
							osc.start(now);
							osc.stop(now + 3);
						});
					}, i*2000);
				}
			}

			function updateClock(){
				let now = new Date();
				let h = now.getHours(), m = now.getMinutes(), s = now.getSeconds();

				if(audioCtx.state === 'running' && s !== lastS){
					playTick();
					lastS = s;
				}

				if(m === 0 && s === 0 && audioCtx.state === 'running' && now.getMilliseconds() < 250){
					playBell(h);
				}

				let sDeg = s*6;
				let mDeg = m*6;
				let hDeg = h*15;

				let finalSDeg = reverse ? -sDeg : sDeg;
				let finalMDeg = reverse ? -mDeg : mDeg;
				let finalHDeg = reverse ? -hDeg : hDeg;

				document.getElementById('sc').style.transform = `rotateZ(${finalSDeg}deg)`;
				document.getElementById('mn').style.transform = `rotateZ(${finalMDeg}deg)`;
				document.getElementById('hr').style.transform = `rotateZ(${finalHDeg}deg)`;
				document.getElementById('sec_dot').style.transform = `rotateZ(${finalSDeg}deg)`;
				document.getElementById('min_dot').style.transform = `rotateZ(${finalMDeg}deg)`;
				document.getElementById('hr_dot').style.transform = `rotateZ(${finalHDeg}deg)`;

				if(reverse){
					document.getElementById('svg_s').style.transform = `rotate(${270 - sDeg}deg)`;
					document.getElementById('svg_m').style.transform = `rotate(${270 - mDeg}deg)`;
					document.getElementById('svg_h').style.transform = `rotate(${270 - hDeg}deg)`;
				}else{
					document.getElementById('svg_s').style.transform = `rotate(270deg)`;
					document.getElementById('svg_m').style.transform = `rotate(270deg)`;
					document.getElementById('svg_h').style.transform = `rotate(270deg)`;
				}

				document.getElementById('ss').style.strokeDashoffset = 760 -(760*s)/60;
				document.getElementById('mm').style.strokeDashoffset = 630 -(630*m)/60;
				document.getElementById('hh').style.strokeDashoffset = 510 -(510*h)/24;
			}

			function drawNumbers(){
				document.querySelectorAll('#time span').forEach(span => span.remove());
				const timeContainer = document.getElementById("time");
				for(let val = 1; val <= 24; val++){
					let i = reverse ?(24 - val) : val;
					let span = document.createElement('span');
					span.style.setProperty('--i', i);
					span.innerHTML = `<b>${val}</b>`;
					timeContainer.appendChild(span);
				}
			}

			function changeClockDirection(){
				if(audioCtx.state === 'suspended'){
					audioCtx.resume();
				}
				reverse = !reverse;
				drawNumbers();
				updateClock();
			}

			drawNumbers();
			setInterval(updateClock, 200);
			updateClock();
		</script>
	</body>
</html>