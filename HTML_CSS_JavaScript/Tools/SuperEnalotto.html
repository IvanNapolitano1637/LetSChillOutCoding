<!DOCTYPE html>
<html lang="en"><!--T04#010 - Gennaro - SuperEnalotto-->
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Dammi sei numeri!</title>
		<style>
			body{
				font-family: sans-serif;
				padding: 20px;
				line-height: 1.6;
			}
			.container{
				max-width: 500px;
				margin: auto;
				background: #f4f4f4;
				padding: 20px;
				border-radius: 10px;
				border: 2px solid #2e7d32;
			}
			output{
				display: block;
				background: #FA9619;
				color: white;
				padding: 5px 10px;
				border-radius: 5px;
				font-weight: bold;
				margin-bottom: 5px;
			}
			input[type="number"], input[type="text"], textarea{
				width: 100%;
				box-sizing: border-box;
				padding: 8px;
				margin-bottom: 10px;
				border: 1px solid #ccc;
				border-radius: 4px;
			}
			button{
				background-color: #43A038;
				color: white;
				border: none;
				padding: 10px 15px;
				border-radius: 5px;
				cursor: pointer;
				font-weight: bold;
				margin-bottom: 15px;
			}
			button:hover{
				background-color: #2e7d32;
			}
			.btn-pulisci{
				background-color: #d32f2f;
				margin-top: 20px;
				width: 100%;
			}
			.btn-pulisci:hover{
				background-color: #b71c1c;
			}
			#info-data{
				font-size: 0.9em;
				color: #333;
				margin-bottom: 10px;
				font-style: italic;
			}
			.reset-link{
				font-size: 0.8em;
				color: #1565c0;
				text-decoration: underline;
				cursor: pointer;
				display: block;
				margin-top: -5px;
				margin-bottom: 10px;
			}
			.reset-link:hover{
				color: #0d47a1;
			}
		</style>
	</head>
	<body style="background-color:#43A038;">

		<div class="container">
			<div id="info-data">Caricamento data prossima estrazione...</div>
			
			<form id="lottoForm">
				<label for="numeroIninput">Sestina da indice numerico:</label>
				<output>Inserisci un numero da 1 a 622.614.630</output>
				<input type="number" id="numeroIninput" value="1" min="1" max="622614630"/>
				<button type="button" onclick="gestisciAzione('getSestinaDaNumero')">Genera Sestina →</button>
				<input type="text" id="sestinaDaNumero" readonly placeholder="Sestina generata">

				<label for="inputTestuale">Sestina basata su testo(Seed):</label>
				<output>Scrivi una frase per la tua sestina personalizzata</output>
				<textarea id="inputTestuale" rows="3" placeholder="Es: Voglio vincere oggi!"></textarea>
				
				<span class="reset-link" onclick="resetUserFingerprint()">Cambia la mia impronta fortunata</span>

				<button type="button" onclick="gestisciAzione('getSestina')">Genera da testo →</button>
				<input type="text" id="sestinaDaTesto" readonly placeholder="Sestina generata">

				<label>Sestina completamente casuale:</label>
				<output>Lascia decidere alla fortuna</output>
				<button type="button" onclick="gestisciAzione('getSestinaACaso')">Sestina Casuale →</button>
				<input type="text" id="sestinaCasuale" readonly placeholder="Sestina generata">

				<button type="button" class="btn-pulisci" onclick="pulisciCampi()">Pulisci Tutto</button>
			</form>
		</div>

		<script>
			//(90*89*88*87*86*85)/(1*2*3*4*5*6) = 89*11*87*43*17*10 = 622.614.630
			//622.614.630 - 1 = 622.614.629 = 7³ * 13 * 19 * 7349
			const TOT_COMBINAZIONI = 622614630;
			const INDICI = [1,2520708,5041415,7562122,10082829,12603536,15124243,17644950,20165657,22686364,25207071,27727778,30248485,32769192,35289899,37810606,40331313,42852020,45372727,47893434,50414141,52934848,55455555,57976262,60496969,63017676,65538383,68059090,70579797,73100504,75621211,78141918,80662625,83183332,85704039,88224746,90745453,93266160,95786867,98307574,100828281,103348988,105869695,108390402,110911109,113431816,115952523,118473230,120993937,123514644,126035351,128556058,131076765,133597472,136118179,138638886,141159593,143680300,146201007,148721714,151242421,153763128,156283835,158804542,161325249,163845956,166366663,168887370,171408077,173928784,176449491,178970198,181490905,184011612,186532319,189053026,191573733,194094440,196615147,199135854,201656561,204177268,206697975,209218682,211739389,214260096,216780803,219301510,221822217,224342924,226863631,229384338,231905045,234425752,236946459,239467166,241987873,244508580,247029287,249549994,252070701,254591408,257112115,259632822,262153529,264674236,267194943,269715650,272236357,274757064,277277771,279798478,282319185,284839892,287360599,289881306,292402013,294922720,297443427,299964134,302484841,305005548,307526255,310046962,312567669,315088376,317609083,320129790,322650497,325171204,327691911,330212618,332733325,335254032,337774739,340295446,342816153,345336860,347857567,350378274,352898981,355419688,357940395,360461102,362981809,365502516,368023223,370543930,373064637,375585344,378106051,380626758,383147465,385668172,388188879,390709586,393230293,395751000,398271707,400792414,403313121,405833828,408354535,410875242,413395949,415916656,418437363,420958070,423478777,425999484,428520191,431040898,433561605,436082312,438603019,441123726,443644433,446165140,448685847,451206554,453727261,456247968,458768675,461289382,463810089,466330796,468851503,471372210,473892917,476413624,478934331,481455038,483975745,486496452,489017159,491537866,494058573,496579280,499099987,501620694,504141401,506662108,509182815,511703522,514224229,516744936,519265643,521786350,524307057,526827764,529348471,531869178,534389885,536910592,539431299,541952006,544472713,546993420,549514127,552034834,554555541,557076248,559596955,562117662,564638369,567159076,569679783,572200490,574721197,577241904,579762611,582283318,584804025,587324732,589845439,592366146,594886853,597407560,599928267,602448974,604969681,607490388,610011095,612531802,615052509,617573216,620093923,622614630];
			const ALCUNE_SESTINE = ["1,2,3,4,5,6","1,3,5,48,50,58","1,4,10,19,41,76","1,5,17,20,49,77","1,6,29,32,77,82","1,8,10,29,41,66","1,9,24,27,38,44","1,11,14,26,57,80","1,12,40,74,82,83","1,14,35,58,61,73","1,16,43,46,70,82","1,19,24,28,37,53","1,21,62,79,87,89","1,25,31,37,85,90","1,29,39,41,67,71","1,35,41,56,61,81","1,46,51,53,65,90","2,3,21,43,50,69","2,4,31,34,35,56","2,6,7,11,40,70","2,7,15,41,46,53","2,8,31,53,65,76","2,10,16,29,41,59","2,11,44,56,60,77","2,13,32,60,66,86","2,15,33,49,54,62","2,17,47,70,74,83","2,20,30,31,42,72","2,23,32,39,49,56","2,27,29,32,38,84","2,31,55,62,72,82","2,39,43,46,50,63","2,69,79,81,86,90","3,5,10,16,27,45","3,6,18,34,53,70","3,7,34,55,67,69","3,9,15,22,54,84","3,10,36,49,72,79","3,12,24,45,62,84","3,14,22,29,60,63","3,16,25,41,51,89","3,18,38,39,42,49","3,21,29,63,67,80","3,24,37,47,51,76","3,28,39,70,76,81","3,33,65,68,73,87","3,43,46,49,62,90","4,5,16,31,32,72","4,6,28,30,35,40","4,8,10,12,28,64","4,9,23,29,73,90","4,11,13,47,63,77","4,12,38,71,87,89","4,14,34,40,63,90","4,16,40,65,85,90","4,19,23,30,79,87","4,21,54,65,68,79","4,25,30,32,48,77","4,29,37,43,63,82","4,35,39,51,81,87","4,46,47,54,56,77","5,6,27,33,45,79","5,8,9,34,60,86","5,9,22,40,46,89","5,11,13,25,38,65","5,12,37,49,57,79","5,14,33,37,42,87","5,16,39,45,49,64","5,19,22,41,67,68","5,21,50,65,77,85","5,25,29,33,56,75","5,29,35,74,75,85","5,35,38,40,44,46","5,45,60,77,86,88","6,7,28,52,77,78","6,9,12,32,41,83","6,10,30,32,49,64","6,12,20,49,88,90","6,14,18,45,75,76","6,16,21,37,57,77","6,18,31,33,55,90","6,21,25,27,57,64","6,24,30,50,53,88","6,28,32,41,52,85","6,33,42,48,57,87","6,42,45,48,69,89","7,8,17,47,56,79","7,9,40,46,49,78","7,11,23,27,34,71","7,13,18,28,74,77","7,15,18,44,59,64","7,17,24,26,61,70","7,19,40,48,51,83","7,22,36,69,83,90","7,26,27,72,82,88","7,30,40,52,78,88","7,36,64,66,74,85","7,50,77,79,85,86","8,10,13,33,46,56","8,11,35,37,49,82","8,13,27,34,47,76","8,15,27,56,63,70","8,17,36,60,79,87","8,20,25,27,68,90","8,23,26,56,66,85","8,26,45,58,75,80","8,31,39,68,80,86","8,38,46,65,72,86","8,58,64,80,84,90","9,11,23,46,75,84","9,13,18,50,72,85","9,15,19,25,40,84","9,17,24,46,47,62","9,19,41,64,73,89","9,22,38,41,57,80","9,26,28,49,76,90","9,30,42,43,76,87","9,37,38,49,55,61","9,51,55,64,67,73","10,12,18,50,57,82","10,14,16,60,79,82","10,16,19,34,51,68","10,18,27,72,73,76","10,21,22,45,62,88","10,24,27,46,47,69","10,28,29,31,53,68","10,33,36,67,69,81","10,41,52,61,66,79","11,12,21,36,44,72","11,14,19,30,80,89","11,16,22,29,48,56","11,18,32,37,77,81","11,21,25,63,73,84","11,24,31,57,62,65","11,28,33,49,57,84","11,33,44,56,69,76","11,42,47,82,83,89","12,13,26,31,59,80","12,15,26,49,81,84","12,17,35,38,40,43","12,20,24,27,55,76","12,23,25,52,69,77","12,26,42,62,67,71","12,31,37,64,74,88","12,38,43,61,68,74","12,57,62,64,75,87","13,15,40,53,72,76","13,18,19,46,58,89","13,20,35,48,54,56","13,23,38,55,56,63","13,27,34,41,68,83","13,32,37,41,52,66","13,39,61,74,85,86","14,15,18,28,35,57","14,17,23,40,62,71","14,19,39,43,77,88","14,22,35,79,80,86","14,26,27,37,43,84","14,30,39,47,69,70","14,36,58,59,65,79","14,50,61,73,74,80","15,17,33,57,60,73","15,20,23,32,70,85","15,23,24,69,73,86","15,26,40,60,67,84","15,31,36,44,55,78","15,38,41,55,64,79","15,56,63,70,79,81","16,19,21,74,76,84","16,21,47,65,73,89","16,25,28,36,43,55","16,29,34,56,58,61","16,35,36,54,77,81","16,45,54,72,80,83","17,19,24,27,50,51","17,21,62,69,74,76","17,25,31,37,39,60","17,29,39,40,62,77","17,35,41,54,57,64","17,46,50,78,86,90","18,20,29,37,72,77","18,23,31,45,50,80","18,27,28,40,51,76","18,31,52,56,72,88","18,39,41,59,70,78","18,66,73,83,86,89","19,22,48,53,65,90","19,26,33,61,68,76","19,30,57,78,79,83","19,37,48,76,82,90","19,53,61,68,75,83","20,23,34,41,68,76","20,27,30,56,61,62","20,32,33,36,67,80","20,39,47,52,56,71","21,22,23,52,68,73","21,25,33,37,67,82","21,29,42,46,47,86","21,35,45,51,66,90","21,46,60,63,74,84","22,24,51,73,83,85","22,28,60,73,76,90","22,34,45,51,58,65","22,44,51,59,67,79","23,25,36,41,73,84","23,29,47,69,75,84","23,35,52,73,82,83","23,47,53,61,66,79","24,27,33,36,73,82","24,32,35,59,61,64","24,39,55,57,58,71","25,26,29,79,81,86","25,30,44,70,82,90","25,37,40,58,69,87","25,51,68,69,80,86","26,30,41,45,53,78","26,36,70,79,82,89","26,51,53,58,77,88","27,31,46,47,58,82","27,38,59,61,70,84","27,62,64,77,80,83","28,34,40,46,58,83","28,43,67,77,78,80","29,32,34,38,77,78","29,39,49,75,76,77","30,31,34,42,52,71","30,37,76,77,84,90","30,55,61,67,74,84","31,38,40,55,72,89","31,56,58,71,78,89","32,39,60,79,82,87","33,34,41,49,52,85","33,44,45,64,87,89","34,38,41,50,51,85","34,56,62,66,89,90","35,45,58,71,74,89","36,42,43,50,79,82","37,40,47,54,66,86","38,40,42,45,65,77","39,40,58,69,73,80","40,42,57,71,79,89","41,46,55,66,82,84","42,55,68,82,84,85","44,50,55,57,71,76","46,52,76,80,86,90","49,52,57,66,73,86","53,59,61,66,68,84","85,86,87,88,89,90"];

			let dataProssimaEstrazione = "";

			function getUserFingerprint(){
				let fingerprint = localStorage.getItem('lotto_user_id');
				if(!fingerprint){
					fingerprint = Math.random().toString(36).substring(2) + Date.now().toString(36);
					localStorage.setItem('lotto_user_id', fingerprint);
				}
				return fingerprint;
			}

			function resetUserFingerprint(){
				if(confirm("Vuoi cambiare la tua impronta fortunata? I numeri generati dal testo cambieranno.")){
					localStorage.removeItem('lotto_user_id');
					getUserFingerprint();
					alert("Impronta cambiata con successo!");
					if(document.getElementById("inputTestuale").value){
						getSestina();
					}
				}
			}

			function gestisciAzione(funzioneNome){
				const outputs = ["sestinaDaNumero", "sestinaDaTesto", "sestinaCasuale"];
				outputs.forEach(id => document.getElementById(id).value = "");
				window[funzioneNome]();
			}

			function getSestinaToString(sestina){
				return sestina.map(n => n.toString().padStart(2, ' ')).join(' ');
			}

			function getProssimaSestina(sestina){
				let t = 5;
				while(t >= 0 && sestina[t] === 85 + t){
					t -= 1;
				}
				if(t < 0){
					return sestina;
				}
				sestina[t] = parseInt(sestina[t]) + 1;
				for(let i = t + 1; i < 6; i++){
					sestina[i] = parseInt(sestina[t]) + i - t;
				}
				return sestina;
			}

			function getEnnesimaSestina(n){
				n = n%TOT_COMBINAZIONI;
				if(n === 0){
					n = TOT_COMBINAZIONI;
				}
				let t = 247;
				while(t > 0 && n < parseInt(INDICI[t])){
					t--;
				}
				let sestina = ALCUNE_SESTINE[t].split(",").map(x => parseInt(x));
				for(let i = parseInt(INDICI[t]); i < n; i++){
					sestina = getProssimaSestina(sestina);
				}
				return sestina;
			}

			function getSestinaDaNumero(){
				let val = parseInt(document.getElementById("numeroIninput").value);
				if(isNaN(val) || val < 1){
					val = 1;
				}
				document.getElementById("sestinaDaNumero").value = getSestinaToString(getEnnesimaSestina(val));
			}

			function isDataEstrazione(data){
				const giorno = data.getDay();
				const ore = data.getHours();
				if([2, 4, 5, 6].includes(giorno) && ore < 19){
					return true;
				}
				return false;
			}

			function getDataString(){
				let d = new Date();
				let tentativi = 0;
				while(!isDataEstrazione(d) && tentativi < 14){
					d.setHours(d.getHours() + 12);
					tentativi++;
				}
				const giorniSett = ["Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato"];
				let anno = d.getFullYear();
				let mese =(d.getMonth() + 1).toString().padStart(2, '0');
				let giorno = d.getDate().toString().padStart(2, '0');
				return `${giorniSett[d.getDay()]} ${giorno}/${mese}/${anno}`;
			}

			function setData(){
				dataProssimaEstrazione = getDataString();
				document.getElementById("info-data").innerText = "Prossima estrazione stimata: " + dataProssimaEstrazione;
			}

			function getSestina(){
				let testo = document.getElementById("inputTestuale").value;
				if(testo.trim().length > 0){
					if(!dataProssimaEstrazione){
						setData();
					}

					const userKey = getUserFingerprint();

					let stringaCombinata = dataProssimaEstrazione + testo + userKey;

					let hash = 0;
					for(let i = 0; i < stringaCombinata.length; i++){
						hash =((hash << 5) - hash) + stringaCombinata.charCodeAt(i);
						hash = Math.abs(hash%TOT_COMBINAZIONI);
					}
					document.getElementById("sestinaDaTesto").value = getSestinaToString(getEnnesimaSestina(hash || 1));
				}
			}

			function getSestinaACaso(){
				const randomIdx = Math.floor(Math.random()*TOT_COMBINAZIONI) + 1;
				document.getElementById("sestinaCasuale").value = getSestinaToString(getEnnesimaSestina(randomIdx));
			}

			function pulisciCampi(){
				document.getElementById("lottoForm").reset();
				document.getElementById("sestinaDaNumero").value = "";
				document.getElementById("sestinaDaTesto").value = "";
				document.getElementById("sestinaCasuale").value = "";
			}

			setData();
			setInterval(() => {
				let nuovaData = getDataString();
				if(dataProssimaEstrazione !== nuovaData) setData();
			}, 60000);
		</script>
	</body>
</html>