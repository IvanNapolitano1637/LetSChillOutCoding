<!DOCTYPE HTML>
<html lang="en"><!--G02#003 - Marco - Game of Life-->
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Conway's Game of Life</title>
		<style>
			body{
				background: #9999ff;
				text-align: center;
				font-family: sans-serif;
			}
			canvas{
				border: 2px solid #0000ff;
				cursor: crosshair;
				display: block;
				margin: 10px auto;
				background: #000;
			}
			button, select{
				padding: 8px 12px;
				font-weight: bold;
				cursor: pointer;
				margin: 5px;
				border-radius: 5px;
			}
			.controls{
				background: rgba(255,255,255,0.3);
				padding: 15px;
				display: inline-block;
				border-radius: 10px;
				border: 1px solid #777;
			}
			.speed-box{
				margin-top: 10px;
				font-weight: bold;
			}
			input[type=range]{
				vertical-align: middle;
				cursor: pointer;
			}
		</style>
	</head>
	<body>

		<canvas id="universe">Aggiorna il browser</canvas>

		<div class="controls">
			<button type="button" onclick="refreshPage()">Reset</button>
			<button type="button" onclick="nextGeneration()">Next</button>
			<button type="button" id="life" onclick="live()">Start</button>

			<select id="patterns" onchange="loadPattern(this.value)">
				<option value="">-- Load schema --</option>
				<option value="glider">Glider</option>
				<option value="exploder">Small Exploder</option>
				<option value="row">10 Cell Row</option>
			</select>

			<div class="speed-box">
				Slow <input type="range" id="speedSlider" min="10" max="1000" value="200" step="10" oninput="updateSpeed(this.value)"> Fast
				<span id="speedVal">200</span> ms
			</div>
		</div>

		<script>
			const SIDE = 15;
			const GRID_THICKNESS = 1;
			const ROW_NUMBER = 50;
			const COLUMN_NUMBER = 40;
			const ALIVE_COLOR = "#00ff00";
			const DEAD_COLOR = "#000000";

			let grid = [];
			let dummyGrid = [];
			let goOnAlone = false;
			let nIntervId;
			let currentInterval = 200;
			let canvas, context;

			window.onload = function(){
				canvas = document.getElementById("universe");
				context = canvas.getContext("2d");
				canvas.addEventListener("mousedown", select);
				drawUniverse();
			};

			function updateSpeed(val){
				currentInterval = 1010 - val; 
				document.getElementById("speedVal").innerText = currentInterval;

				if(goOnAlone){
					clearInterval(nIntervId);
					nIntervId = setInterval(nextGeneration, currentInterval);
				}
			}

			function drawSquare(row, column, color){
				context.fillStyle = color;
				context.fillRect(
					(row*(SIDE + GRID_THICKNESS)) + GRID_THICKNESS,
					(column*(SIDE + GRID_THICKNESS)) + GRID_THICKNESS,
					SIDE, SIDE
				);
			}

			function drawUniverse(){
				canvas.width =(SIDE*ROW_NUMBER) +((ROW_NUMBER + 1)*GRID_THICKNESS);
				canvas.height =(SIDE*COLUMN_NUMBER) +((COLUMN_NUMBER + 1)*GRID_THICKNESS);
				context.fillStyle = "#333";
				context.fillRect(0, 0, canvas.width, canvas.height);

				for(let i = 0; i < ROW_NUMBER; i++){
					grid[i] = [];
					dummyGrid[i] = [];
					for(let j = 0; j < COLUMN_NUMBER; j++){
						grid[i][j] = false;
						dummyGrid[i][j] = false;
						drawSquare(i, j, DEAD_COLOR);
					}
				}
			}

			function loadPattern(type){
				if(!type) return;
				refreshPage();
				const midX = Math.floor(ROW_NUMBER/2);
				const midY = Math.floor(COLUMN_NUMBER/2);
				let coords = [];
				if(type === "glider"){
					coords = [[0,1], [1,2], [2,0], [2,1], [2,2]];
				}else if(type === "exploder"){
					coords = [[0,0], [0,1], [0,2], [-1,1], [1,1], [0,3], [0,4]];
				}else if(type === "row"){
					coords = [[-4,0], [-3,0], [-2,0], [-1,0], [0,0], [1,0], [2,0], [3,0], [4,0], [5,0]];
				}

				coords.forEach(([dx, dy]) => {
					let x = midX + dx; let y = midY + dy;
					if(x >= 0 && x < ROW_NUMBER && y >= 0 && y < COLUMN_NUMBER){
						grid[x][y] = true;
						drawSquare(x, y, ALIVE_COLOR);
					}
				});
				document.getElementById("patterns").value = ""; 
			}

			function select(e){
				const rect = canvas.getBoundingClientRect();
				const x = e.clientX - rect.left;
				const y = e.clientY - rect.top;
				let row = Math.floor(x/(SIDE + GRID_THICKNESS));
				let col = Math.floor(y/(SIDE + GRID_THICKNESS));
				if(row >= 0 && row < ROW_NUMBER && col >= 0 && col < COLUMN_NUMBER){
					grid[row][col] = !grid[row][col];
					drawSquare(row, col, grid[row][col] ? ALIVE_COLOR : DEAD_COLOR);
				}
			}

			function nextGeneration(){
				for(let i = 0; i < ROW_NUMBER; i++){
					for(let j = 0; j < COLUMN_NUMBER; j++){
						let neighbors = countNeighbors(i, j);
						if(grid[i][j]){
							dummyGrid[i][j] =(neighbors === 2 || neighbors === 3);
						}else{
							dummyGrid[i][j] =(neighbors === 3);
						}
					}
				}
				for(let i = 0; i < ROW_NUMBER; i++){
					for(let j = 0; j < COLUMN_NUMBER; j++){
						grid[i][j] = dummyGrid[i][j];
						drawSquare(i, j, grid[i][j] ? ALIVE_COLOR : DEAD_COLOR);
					}
				}
			}

			function countNeighbors(x, y){
				let count = 0;
				for(let i = -1; i <= 1; i++){
					for(let j = -1; j <= 1; j++){
						if(i === 0 && j === 0){
							continue;
						}
						let r = x + i, c = y + j;
						if(r >= 0 && r < ROW_NUMBER && c >= 0 && c < COLUMN_NUMBER && grid[r][c]){
							count++;
						}
					}
				}
				return count;
			}

			function live(){
				const btn = document.getElementById("life");
				if(!goOnAlone){
					goOnAlone = true;
					nIntervId = setInterval(nextGeneration, currentInterval);
					btn.innerHTML = "Stop";
					btn.style.backgroundColor = "#ff4444";
				}else{
					goOnAlone = false;
					clearInterval(nIntervId);
					btn.innerHTML = "Start";
					btn.style.backgroundColor = "";
				}
			}

			function refreshPage(){
				if(goOnAlone) live();
				drawUniverse();
			}
		</script>
	</body>
</html>