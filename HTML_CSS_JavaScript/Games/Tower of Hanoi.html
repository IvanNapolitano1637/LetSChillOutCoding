<!DOCTYPE HTML>
<html lang="en"><!--G03#007 - Luca - Tower of Hanoi-->
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>Tower of Hanoi</title>
		<style>
			:root{
				--accent-color: #4a90e2;
				--button-hover: #357abd;
				--panel-bg: rgba(255, 255, 255, 0.85);
			}
			body{
				font-family: 'Segoe UI', Tahoma, sans-serif;
				background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
				background-attachment: fixed;
				text-align: center;
				display: flex;
				flex-direction: column;
				align-items: center;
				margin: 0;
				padding: 20px;
				min-height: 100vh;
				user-select: none;
				-webkit-user-select: none;
				touch-action: manipulation;
			}
			.top-bar{
				display: flex;
				align-items: center;
				gap: 10px;
				margin-bottom: 15px;
			}
			.stats{
				background: var(--panel-bg);
				padding: 10px 25px;
				border-radius: 50px;
				font-weight: bold;
				font-size: 1.2em;
				box-shadow: 0 4px 10px rgba(0,0,0,0.1);
				color: #333;
				display: flex;
				align-items: center;
			}
			.stats span{
				margin-left: 8px;
			}
			canvas{
				background: rgba(255, 255, 255, 0.2);
				cursor: pointer;
				display: block;
				margin: 10px auto;
				max-width: 100%;
				height: auto;
				border-radius: 15px;
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
				border: 2px solid rgba(255, 255, 255, 0.4);
				touch-action: none;
				-webkit-tap-highlight-color: transparent;
			}
			.controls{
				background: var(--panel-bg);
				padding: 15px 25px;
				border-radius: 12px;
				display: flex;
				flex-wrap: wrap;
				justify-content: center;
				gap: 15px;
				box-shadow: 0 4px 15px rgba(0,0,0,0.05);
			}
			select, button{
				padding: 10px 20px;
				font-size: 14px;
				border-radius: 8px;
				border: none;
				cursor: pointer;
				transition: all 0.2s ease;
				outline: none;
			}
			select{
				background: var(--panel-bg);
				border: 1px solid rgba(255,255,255,0.5);
				box-shadow: 0 4px 10px rgba(0,0,0,0.1);
				font-weight: bold;
				height: 44px;
			}
			button{
				background-color: var(--accent-color);
				color: white;
				font-weight: bold;
				text-transform: uppercase;
			}
			button:hover{
				background-color: var(--button-hover);
				transform: translateY(-2px);
			}
			@media screen and (max-width: 600px){
				.controls{
					width: 90%;
				}
			}
		</style>
	</head>

	<body>

		<div class="top-bar">
			<select id="disksNumber" onchange="changeDiskCount()"></select>
			<div class="stats">Moves: <span id="moveCounter">0</span></div>
		</div>

		<canvas id="universe"></canvas>

		<div class="controls">
			<button type="button" onclick="resetGame()">Restart</button>
			<button type="button" onclick="animatedSolving()">How To (Demo)</button>
		</div>

		<script>
			const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

			function playTone(freq, type, duration) {
				if(audioCtx.state === 'suspended'){
					audioCtx.resume();
				}
				const osc = audioCtx.createOscillator();
				const gain = audioCtx.createGain();
				osc.type = type;
				osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
				gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
				gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
				osc.connect(gain);
				gain.connect(audioCtx.destination);
				osc.start();
				osc.stop(audioCtx.currentTime + duration);
			}

			const DESKTOP = !(/Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i).test(navigator.userAgent);
			const UNIT = DESKTOP ? 9 : 7;
			const H_SPACE = 8*UNIT, V_SPACE = 6*UNIT;
			const WIDTH = 36*UNIT; 
			const PAGE_WIDTH = 3.5*UNIT; 
			const BASE_HEIGHT = 2.5*UNIT;
			const DISK_INCREASE = 3*UNIT; 
			const DISK_BASE_LENGTH = 12*UNIT; 
			const DISK_HEIGHT = (DESKTOP ? 5 : 8)*UNIT; 
			const UPPER_MARGIN = 4*UNIT, UPPER_PAGE_MARGIN = 2*UNIT, LOWER_MARGIN = 2*UNIT;
			const TOTAL_WIDTH = (3*WIDTH) + (4*H_SPACE);
			const BROWN = "#8D6E63", ORANGE = "#FFCA28";
			const COLORS = ["#FF0000", "#00FF00", "#0000FF", "#FFFF00", "#FF00FF", "#00FFFF", "#FF8000", "#8000FF", "#008000", "#333333"];
			let numberOfDisks = 4;
			let moves = 0;
			let universe, context, nIntervId = null;
			let towers = [[], [], []], selectedTower = [false, false, false];
			let activeTower = -1, wan = false, demo = false, steps = "", step = 0;
			let cursorX = 0;
			let totalHeight, pegHeight;

			window.onload = initGame;

			function initGame(){
				universe = document.getElementById("universe");
				context = universe.getContext("2d");
				const handleInteraction = (e) => {
					const rect = universe.getBoundingClientRect();
					const clientX = e.touches ? e.touches[0].clientX : e.clientX;
					const scaleX = universe.width/rect.width;
					cursorX = (clientX - rect.left)*scaleX;
					selectTowerClick();
					if(e.touches){
						e.preventDefault();
					}
				};
				universe.addEventListener('mousedown', handleInteraction);
				universe.addEventListener('touchstart', handleInteraction, {passive: false});
				resetGame();
			}

			function resetGame(){
				document.body.style.background = "linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)";
				if(nIntervId){
					clearInterval(nIntervId);
					nIntervId = null;
				}
				moves = 0;
				updateMoveDisplay();
				pegHeight = numberOfDisks*DISK_HEIGHT + UPPER_PAGE_MARGIN;
				totalHeight = V_SPACE + UPPER_MARGIN + pegHeight + BASE_HEIGHT + LOWER_MARGIN;
				universe.width = TOTAL_WIDTH;
				universe.height = totalHeight;
				wan = false;
				demo = false;
				activeTower = -1;
				towers = [[], [], []];
				selectedTower = [false, false, false];
				for(let i = 0; i < numberOfDisks; i++){
					towers[0][i] = numberOfDisks - i - 1;
					towers[1][i] = -1;
					towers[2][i] = -1;
				}
				const select = document.getElementById("disksNumber");
				if(select.innerHTML === ""){
					for(let i = 1; i <= 10; i++){
						let opt = document.createElement("option");
						opt.value = i; opt.text = "Level " + i;
						if(i === numberOfDisks){
							opt.selected = true;
						}
						select.add(opt);
					}
				}
				steps = calculateSteps(numberOfDisks);
				step = 0;
				drawAll();
			}

			function updateMoveDisplay(){
				document.getElementById("moveCounter").innerText = moves;
			}

			function drawAll(){
				context.clearRect(0, 0, universe.width, universe.height);
				for(let i = 0; i < 3; i++){
					drawTower(i);
				}
			}

			function drawTower(idx){
				let x0 = H_SPACE + idx*(WIDTH + H_SPACE); 
				context.fillStyle = selectedTower[idx] ? ORANGE : "rgba(0,0,0,0.06)";
				context.fillRect(x0, V_SPACE, WIDTH, totalHeight - V_SPACE);
				context.fillStyle = BROWN;
				context.fillRect(x0 + (WIDTH - PAGE_WIDTH)/2, V_SPACE + UPPER_MARGIN, PAGE_WIDTH, pegHeight);
				context.fillRect(x0 + 3*UNIT, V_SPACE + UPPER_MARGIN + pegHeight, WIDTH - 6*UNIT, BASE_HEIGHT);
				for(let i = 0; i < numberOfDisks; i++){
					let diskValue = towers[idx][i];
					if(diskValue >= 0){
						drawDisk(idx, numberOfDisks - i - 1, diskValue);
					}
				}
			}

			function drawDisk(tIdx, level, dSize){
				let w = DISK_BASE_LENGTH + dSize*DISK_INCREASE;
				let x0 = H_SPACE + tIdx*(WIDTH + H_SPACE); 
				let x = x0 + (WIDTH - w)/2; 
				let y = V_SPACE + level*DISK_HEIGHT + UPPER_MARGIN + UPPER_PAGE_MARGIN;
				let h = DISK_HEIGHT - 2;
				context.fillStyle = COLORS[dSize];
				context.strokeStyle = "#000000";
				context.lineWidth = 1.5;
				context.beginPath();
				if(context.roundRect){
					context.roundRect(x, y, w, h, h/2);
				}else{
					context.rect(x, y, w, h);
				}
				context.fill();
				context.stroke();
			}

			function selectTowerClick(){
				if(wan){
					return;
				}
				let towerIdx = -1;
				for(let i = 0; i < 3; i++){
					let xStart = H_SPACE + i*(WIDTH + H_SPACE); 
					if(cursorX >= xStart && cursorX <= xStart + WIDTH){
						towerIdx = i;
						break;
					}
				}
				if(towerIdx === -1){
					return;
				}
				if(activeTower === -1){
					if(getLastDiskIndex(towerIdx) !== -1){
						activeTower = towerIdx;
						selectedTower[towerIdx] = true;
						playTone(440, 'sine', 0.1);
					}
				}else{
					if(activeTower === towerIdx){
						selectedTower[towerIdx] = false;
						activeTower = -1;
					}else{
						if(moveDisk(activeTower, towerIdx)){
							moves++;
							updateMoveDisplay();
							playTone(600, 'sine', 0.1);
						}else{
							playTone(150, 'triangle', 0.2);
						}
						selectedTower[activeTower] = false;
						activeTower = -1;
					}
				}
				drawAll();
				checkWin();
			}

			function moveDisk(from, to){
				let fromIdx = getLastDiskIndex(from);
				let toIdx = getLastDiskIndex(to);
				let diskToMove = towers[from][fromIdx];
				if(toIdx === -1 || diskToMove < towers[to][toIdx]){
					towers[from][fromIdx] = -1;
					towers[to][toIdx + 1] = diskToMove;
					return true;
				}
				return false;
			}

			function getLastDiskIndex(t){
				let idx = numberOfDisks - 1;
				while(idx >= 0 && towers[t][idx] === -1){
					idx--;
				}
				return idx;
			}

			function checkWin(){
				if(towers[1][numberOfDisks - 1] !== -1 || towers[2][numberOfDisks - 1] !== -1){
					wan = true;
					document.body.style.background = "linear-gradient(135deg, #11998e, #38ef7d)";
					playTone(800, 'sine', 0.4);
					if(!demo){
						setTimeout(() => alert("Wonderful! :-D You win in " + moves + " move" + (moves > 1 ? "s" : "") + "! :-D"), 200);
					}
				}
			}

			function changeDiskCount(){
				numberOfDisks = parseInt(document.getElementById("disksNumber").value);
				resetGame();
			}

			function calculateSteps(n){
				let movesList = [];
				function hanoi(num, from, to, aux){
					if(num === 1){
						movesList.push({f: from, t: to});
						return;
					}
					hanoi(num - 1, from, aux, to);
					movesList.push({f: from, t: to});
					hanoi(num - 1, aux, to, from);
				}
				hanoi(n, 0, 2, 1);
				return movesList;
			}

			function animatedSolving(){
				resetGame();
				demo = true;
				nIntervId = setInterval(() => {
					if(step < steps.length){
						let m = steps[step];
						moveDisk(m.f, m.t);
						moves++;
						updateMoveDisplay();
						drawAll();
						checkWin();
						step++;
						playTone(500, 'sine', 0.05);
					}else{
						clearInterval(nIntervId);
					}
				}, 500);
			}
		</script>
	</body>
</html>